<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>nschulzke</title>
    <subtitle>Explorations in language.</subtitle>
    <link href="https://nschulzke.com/atom.xml" rel="self" type="application/atom+xml"/>
    <link href="https://nschulzke.com"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2023-05-07T00:22:25-06:00</updated>
    <id>https://nschulzke.com/atom.xml</id>
    <entry xml:lang="en">
        <title>Introducing Myco: a secure JS runtime</title>
        <published>2023-05-07T00:22:25-06:00</published>
        <updated>2023-05-07T00:22:25-06:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://nschulzke.com/23-05-07-introducing-myco/" type="text/html"/>
        <id>https://nschulzke.com/23-05-07-introducing-myco/</id>
        
        <content type="html">&lt;p&gt;A few months back I wrote about &lt;a href=&quot;https:&#x2F;&#x2F;nschulzke.com&#x2F;23-05-07-introducing-myco&#x2F;22_12_06_effects_capabilities_and_log4shell&quot;&gt;Log4Shell and its implications for language design&lt;&#x2F;a&gt;. Since then I&#x27;ve worked on a number of language concepts based around these ideas, but always hit a wall. There is &lt;em&gt;so much&lt;&#x2F;em&gt; to build when you&#x27;re starting a language from scratch, and I never made it to the effects or capabilities concepts that I wanted to explore.&lt;&#x2F;p&gt;
&lt;p&gt;Yesterday I stumbled upon &lt;a href=&quot;https:&#x2F;&#x2F;deno.com&#x2F;blog&#x2F;roll-your-own-javascript-runtime&quot;&gt;a blog post by Deno&lt;&#x2F;a&gt; where they demonstrate how to use the &lt;code&gt;deno_core&lt;&#x2F;code&gt; crate to implement new JS runtimes on top of Deno. After following along with the blog post I realized that they provided all the tools needed to start an experiment in object-capabilities, so over the past 24 hours I built out enough of a proof of concept that I feel ready to demo it and explain my goals for the future.&lt;&#x2F;p&gt;
&lt;img style=&quot;height: 6em;&quot; src=&quot;&#x2F;img&#x2F;23-05&#x2F;myco-logo.png&quot; alt=&quot;Myco logo&quot;&#x2F;&gt; 
&lt;h2 id=&quot;myco-object-capabilities-for-javascript&quot;&gt;Myco: Object-Capabilities for JavaScript&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mycojs&#x2F;myco&quot;&gt;Myco&lt;&#x2F;a&gt; is a new, experimental JavaScript runtime designed to provide a clearly visible flow of authority. In Myco, all functions capable of causing external effects (such as network or file access) are enclosed in the &lt;code&gt;Myco&lt;&#x2F;code&gt; object, which is not made available globally. Instead it&#x27;s passed in to the default export of the main module, like this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;typescript&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-typescript &quot;&gt;&lt;code class=&quot;language-typescript&quot; data-lang=&quot;typescript&quot;&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; index.ts
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;export default &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span&gt;({&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Myco&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;log.txt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;requestRead&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;contents &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;read&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#7a7025;&quot;&gt;log&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Read from a file&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;contents&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;err&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#7a7025;&quot;&gt;error&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Unable to read file&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;err&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Since there&#x27;s no way to import the &lt;code&gt;Myco&lt;&#x2F;code&gt; object it has to be passed down from this main function to child functions.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;scoped-access-passing-tokens&quot;&gt;Scoped access: passing tokens&lt;&#x2F;h3&gt;
&lt;p&gt;This feature is what sets Myco apart from other runtimes like Node and Deno: security is considered per-scope, not per-application. In Node or Deno, the entire application has access to do something or it doesn&#x27;t. If you need access to a privileged API in your code, you have to give it to all of your libraries as well. This is fine if you trust them, but we&#x27;ve repeatedly seen that &lt;a href=&quot;https:&#x2F;&#x2F;dl.acm.org&#x2F;doi&#x2F;pdf&#x2F;10.1145&#x2F;358198.358210&quot;&gt;libraries cannot always be trusted&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;In Myco, you can delegate a thin slice of your application&#x27;s permissions to a library. For example, if we have a library that needs to load its data from a file, we &lt;em&gt;could&lt;&#x2F;em&gt; let it access the whole filesystem, but that would be overkill and could lead to security vulnerabilities. Instead, we can grant the library read access to the one file that it cares about:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;typescript&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-typescript &quot;&gt;&lt;code class=&quot;language-typescript&quot; data-lang=&quot;typescript&quot;&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; index.ts
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readDataFromFile&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;somewhat-trustworthy-lib&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;export default &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span&gt;({&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Myco&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;stored-data.json&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;requestRead&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;libraryObj &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;readDataFromFile&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; Do something with the libraryObj
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Inside the library, the function:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;typescript&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-typescript &quot;&gt;&lt;code class=&quot;language-typescript&quot; data-lang=&quot;typescript&quot;&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; somewhat-trustworthy-lib.ts
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;readDataFromFile&lt;&#x2F;span&gt;&lt;span&gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Myco&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Files&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;ReadToken
&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;fileContents &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;read&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;parse&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;fileContents&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;data&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Because access to the filesystem is restricted to those functions that have access to the &lt;code&gt;Myco.Files&lt;&#x2F;code&gt; object, our library&#x27;s permissions are limited to reading the specific file that we passed a token for: &lt;code&gt;.&#x2F;stored-data.json&lt;&#x2F;code&gt;. It cannot read from any other files, and it cannot write to &lt;em&gt;any&lt;&#x2F;em&gt; files.&lt;&#x2F;p&gt;
&lt;p&gt;It would be a bit of a pain to have to pass in every single file that a library needs access to, so Myco provides a way to give a handle on a whole directory:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;typescript&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-typescript &quot;&gt;&lt;code class=&quot;language-typescript&quot; data-lang=&quot;typescript&quot;&gt;&lt;span style=&quot;color:#016692;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;LibClass&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;somewhat-trustworthy-lib&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;export default &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span&gt;({&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Myco&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;directory &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;requestReadWriteDir&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;data&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;lib &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= new &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;LibClass&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;directory&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; Do stuff with lib
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Inside of &lt;code&gt;LibClass&lt;&#x2F;code&gt;, the library can use the directory token to read and write any files within the directory, but not outside of it.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;unscoped-access-passing-the-myco-object&quot;&gt;Unscoped access: passing the Myco object&lt;&#x2F;h3&gt;
&lt;p&gt;If we want to grant permission to perform arbitrary file I&#x2F;O to a child function, we can just give it the whole &lt;code&gt;files&lt;&#x2F;code&gt; object. This is best suited for internal code, and would not be appropriate in a library API.&lt;&#x2F;p&gt;
&lt;p&gt;Here&#x27;s how that would work:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;typescript&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-typescript &quot;&gt;&lt;code class=&quot;language-typescript&quot; data-lang=&quot;typescript&quot;&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; index.ts
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;childFunction&lt;&#x2F;span&gt;&lt;span&gt;} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;module&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;export default &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span&gt;({&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;_console&lt;&#x2F;span&gt;&lt;span&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Myco&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;console &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;_console&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;childFunction&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; module.ts
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;childFunction&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Myco&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;text-decoration:underline;color:#646409;&quot;&gt;Files&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;.&#x2F;log.txt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;files&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;requestRead&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;contents &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;readToken&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;read&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#7a7025;&quot;&gt;log&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Read from a file&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;contents&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;catch &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;err&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#7a7025;&quot;&gt;error&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Unable to read file&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;err&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The trust level is higher in a call like this, because arbitrary files can be accessed, but it&#x27;s also more flexible.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-s-next-for-myco&quot;&gt;What&#x27;s next for Myco&lt;&#x2F;h2&gt;
&lt;p&gt;The current iteration of Myco is &lt;em&gt;very&lt;&#x2F;em&gt; much a prototype, but I&#x27;m very excited about where it&#x27;s going. I&#x27;m still pretty new to Rust, so I expect that the code could use a lot of improvements.&lt;&#x2F;p&gt;
&lt;p&gt;Production-time compatibility with the existing NPM ecosystem is a non-goal for Myco because the scoped security model leads to a dramatically different philosophical approach to dependencies. &lt;a href=&quot;https:&#x2F;&#x2F;xkcd.com&#x2F;2347&#x2F;&quot;&gt;The tall dependency towers&lt;&#x2F;a&gt; that we&#x27;ve come to expect on NPM are impractical when permissions have to be explicitly passed down the tree, so I expect to see broader, shallower dependency graphs that require few permissions.&lt;&#x2F;p&gt;
&lt;p&gt;One of my first goals is to figure out what we &lt;em&gt;will&lt;&#x2F;em&gt; be using to manage packages and as replacement build tooling. Getting TypeScript working is a first priority.&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;m thinking to start working through these questions by getting a proper web server running in Myco. Aside from helping me to work through the tooling questions, running a server of moderate complexity should help me to recognize the weak parts of the model and develop solutions to the ergonomic problems, as well as giving us something to benchmark performance-wise.&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;m pretty happy with what I have so far and excited to move forward with the tooling!&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Effects, Capabilities, and Log4Shell</title>
        <published>2022-12-06T00:22:25-06:00</published>
        <updated>2022-12-06T00:22:25-06:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://nschulzke.com/22-12-06-effects-capabilities-and-log4shell/" type="text/html"/>
        <id>https://nschulzke.com/22-12-06-effects-capabilities-and-log4shell/</id>
        
        <content type="html">&lt;p&gt;One year ago, the Log4J logging library, which is widely used in the Java ecosystem, was hit by the Log4Shell vulnerability.&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; This bug allowed attackers to execute arbitrary code on a server running Log4J by sending a carefully crafted log message.&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerability was caused by a flaw in how Log4J handled log messages that contained JNDI references. JNDI is a Java API that lets applications access naming and directory services, like LDAP and DNS. In the case of Log4Shell, the attacker was able to use JNDI references in a log message to remotely run code on the vulnerable server.&lt;&#x2F;p&gt;
&lt;p&gt;Most Log4J users were shocked to learn that the library could access the internet and execute remote code, since it&#x27;s usually used for more basic tasks like formatting log messages and rotating log files. The inclusion of JNDI lookups in Log4J was intentional, but few people who were using the library knew about or wanted this feature.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;trusting-trust&quot;&gt;Trusting trust&lt;&#x2F;h1&gt;
&lt;p&gt;Ken Thompson, in his 1983 Turing Award lecture &amp;quot;Reflections on Trusting Trust&amp;quot;, warned about trusting code you did not write:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can&#x27;t trust code that you did not totally create yourself. ... No amount of source-level verification or scrutiny will protect you from using untrusted code.&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Thompson argues that a manual audit of even a &lt;em&gt;small&lt;&#x2F;em&gt; amount of external code is insufficient to determine if it is trustworthy. If you do not trust the author of the code, you cannot reasonably trust the code, no matter how much you&#x27;ve looked through it.&lt;&#x2F;p&gt;
&lt;p&gt;Today our systems are built with an ever-increasing amount of external, open-source code. This has been a tremendous boon for productivity across the entire industry because we no longer have to reinvent the wheel with each project. What is becoming apparent is that the cost of this speed is that we now trust an increasing number of people with the fate of our own software.&lt;&#x2F;p&gt;
&lt;p&gt;If, as Thompson argues, we cannot rely on manual verification, we have three main options: accept our vulnerability, abandon open source, or find a tool that can reliably verify code safety for us. Unfortunately, our current tools weren&#x27;t designed to cope with this explosion of third-party code. Most OSes default to assuming that any executable that a given user runs should have the same privileges as any other executable. Our languages, in turn, assume that all code that runs within a single program is equally trustworthy.&lt;&#x2F;p&gt;
&lt;p&gt;These assumptions are no longer valid. Code that is written by an internal team is far more trustworthy than code that comes from further up the supply chain. Even if the OS were to be made more secure, not every privilege granted to our first-party code should be made transitively available to third-party libraries. In order to solve the software supply-chain crisis without losing open source, our languages must adapt to the new environment.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;language-level-security&quot;&gt;Language-level security&lt;&#x2F;h1&gt;
&lt;p&gt;Trust is the fatal flaw in almost every modern programming language. They assume that &lt;em&gt;all&lt;&#x2F;em&gt; code should be allowed to do anything that the OS is willing to allow &lt;em&gt;any&lt;&#x2F;em&gt; code to do. In the case of Log4Shell, Java not only grants access to JNDI lookups unless explicitly disabled, it assumes that if &lt;em&gt;any&lt;&#x2F;em&gt; code needs access to JNDI then &lt;em&gt;all&lt;&#x2F;em&gt; code should have access to it.&lt;&#x2F;p&gt;
&lt;p&gt;This extends to each feature you might use. Do you need to bind to a port? Then all code in your project can bind to a port. Do you need to read from a file? Then all code in your project can read from that file (and if you&#x27;re not careful with OS permissions, from the entire filesystem). Do you need to talk to external services? Then any library can phone home for any reason.&lt;&#x2F;p&gt;
&lt;p&gt;In order to safely use open-source software, our languages need to fix this flaw. We need to be able to bring in libraries that we trust to a point, but no further. I should be able to add a logging library and be 100% confident that it isn&#x27;t talking to external servers, much less downloading and executing remote code. I should be able to bring in a linear algebra library and know that it isn&#x27;t accessing the filesystem. I should be able to look at each call to external code and, from the call site, &lt;em&gt;know&lt;&#x2F;em&gt; what it is allowed to do.&lt;&#x2F;p&gt;
&lt;p&gt;There are two language features I am aware of that are perfectly suited to solving this problem: Capabilities and Effects. In the rest of this post I&#x27;m going to give a brief introduction to these two concepts, with links for those who wish to explore more. I&#x27;ll be using some made-up syntax to bolt these concepts onto Java for the sake of example, but I&#x27;m not advocating for a particular implementation, just illustrating the concepts.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;capabilities&quot;&gt;Capabilities&lt;&#x2F;h1&gt;
&lt;p&gt;Capabilities&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#3&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; are a means of controlling authorization by restricting the use of a sensitive resource to code that has been granted an unforgeable access token. In an Object Oriented language, a reference to an object can (if unforgeable) function as a capability: if you do not have a reference to the object, you cannot call any of its methods. To implement a capabilities-based security model in an OO language, you make it impossible to instantiate security-sensitive objects directly, instead requiring they be passed in from further up the call tree.&lt;&#x2F;p&gt;
&lt;p&gt;In Java today, any piece of code can get a handle for any file for reading or writing, as long as the OS gives permission:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;ReadFile &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;File&lt;&#x2F;span&gt;&lt;span&gt; file &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;File&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;top_secret_data.txt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; Now I can do anything with this file
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;In this example, we&#x27;re accessing the file directly within the main method, but it would be entirely possible for this exact code to run deep in some library. Compromised code can use this feature to wreak havoc.&lt;&#x2F;p&gt;
&lt;p&gt;In contrast, this is what a capabilities model might look like in Java:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;ReadFile &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;Host &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;host&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;File&lt;&#x2F;span&gt;&lt;span&gt; file &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span&gt; host.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;requestFile&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;top_secret_data.txt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; Now I can do anything with this file
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;In the capabilities version of Java, we remove the public constructor for &lt;code&gt;File&lt;&#x2F;code&gt; and replace it with a call to a &lt;code&gt;Host&lt;&#x2F;code&gt; object that is passed into &lt;code&gt;main&lt;&#x2F;code&gt; by the runtime. The only way to get access to &lt;em&gt;any&lt;&#x2F;em&gt; sensitive resource is to request it from the &lt;code&gt;Host&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Under this model, Log4J would have had to receive the &lt;em&gt;capability&lt;&#x2F;em&gt; to use JNDI from &lt;code&gt;Host&lt;&#x2F;code&gt;. This could be done by requesting &lt;code&gt;Host&lt;&#x2F;code&gt; directly, but that would put up red flags for security. Instead, they would need to provide a version of &lt;code&gt;getLogger&lt;&#x2F;code&gt; that requests a JNDI context:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;LogExample &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;Host &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;host&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;Logger&lt;&#x2F;span&gt;&lt;span&gt; logger &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;LogManager&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;getLogger&lt;&#x2F;span&gt;&lt;span&gt;(host.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;requestJndiContext&lt;&#x2F;span&gt;&lt;span&gt;());
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If the only way to get access to JNDI were to get it through the &lt;code&gt;Host&lt;&#x2F;code&gt; object, and the only way to get access to the &lt;code&gt;Host&lt;&#x2F;code&gt; object is through the &lt;code&gt;main&lt;&#x2F;code&gt; function, then JNDI becomes opt-in and, what&#x27;s more, finely controlled: no application can accidentally use JNDI, and in any application that &lt;em&gt;needs&lt;&#x2F;em&gt; JNDI we can easily verify which modules were granted access.&lt;&#x2F;p&gt;
&lt;p&gt;The major flaw in the capabilities implementation shown above is that there is a lot of boilerplate involved in passing around object handles instead of being able to construct them on the fly deep in nested code. This could result in programmers passing the whole &lt;code&gt;Host&lt;&#x2F;code&gt; object far deeper in the code than is strictly necessary, weakening the security of their applications (though it wouldn&#x27;t ever get weaker than it currently is).&lt;&#x2F;p&gt;
&lt;p&gt;The boilerplate could be aleviated with a feature like Scala 3&#x27;s context parameters.&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#4&quot;&gt;4&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; The capabilities required would remain in the function signatures, easy to inspect at every level of the code, but wouldn&#x27;t need to be explicitly provided as long as they&#x27;re available in the caller.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;effects&quot;&gt;Effects&lt;&#x2F;h1&gt;
&lt;p&gt;Where capabilities lend themselves well to an object-oriented style, effects originate in the functional programming world. In their original context, they&#x27;re intended to be used for handling all side effects, but they could also easily be scoped to only handle security-sensitive effects.&lt;&#x2F;p&gt;
&lt;p&gt;An effect system is a way of tracking and managing side effects in a programming language&#x27;s type system. They are similar to Java&#x27;s checked exceptions, but more general and flexible. In an effect system, the side effects that a function can perform are specified in its signature. Functions that call other functions can either handle the effects themselves or pass them along to other functions higher up in the call chain. After an effect has been handled, the code that originally performed the effect can resume execution.&lt;&#x2F;p&gt;
&lt;p&gt;You can think of an effect system as a kind of &amp;quot;resumable exception&amp;quot; mechanism. It allows developers to specify and enforce constraints on the ways that code can interact with external resources, such as the file system or the network. Because this information is included in the function signature, it becomes glaringly obvious what sorts of vulnerabilities any given library is at risk of.&lt;&#x2F;p&gt;
&lt;p&gt;For example, loading a file can be implemented as an effect that a function &lt;code&gt;performs&lt;&#x2F;code&gt; (which is used the same way as &lt;code&gt;throws&lt;&#x2F;code&gt; is for exceptions):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java-effects&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java-effects &quot;&gt;&lt;code class=&quot;language-java-effects&quot; data-lang=&quot;java-effects&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;ReadFile &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;performs &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;OpenFile &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;Optional&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;File&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; file &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= perform new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;OpenFile&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;top_secret_data.txt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; Now I can do anything with this file
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The &lt;code&gt;perform&lt;&#x2F;code&gt; keyword is the equivalent of &lt;code&gt;throw&lt;&#x2F;code&gt; for exceptions: it hands control up the stack to the next handler, in this case directly to the runtime. The difference is that &lt;code&gt;perform&lt;&#x2F;code&gt; is an expression: it evaluates to the result generated by the handler.&lt;&#x2F;p&gt;
&lt;p&gt;The type that it evaluates to is defined as part of the effect:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java-effects&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java-effects &quot;&gt;&lt;code class=&quot;language-java-effects&quot; data-lang=&quot;java-effects&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;OpenFile &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;implements &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#d19264;&quot;&gt;Effect&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;Optional&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;File&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;OpenFile&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;pathname&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; ...
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; ...
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If Java had an effect system, Log4J could have implemented JNDI lookup as an effect:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java-effects&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java-effects &quot;&gt;&lt;code class=&quot;language-java-effects&quot; data-lang=&quot;java-effects&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;JndiLogger &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;debug&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;CharSequence &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;message&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;performs &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLookup
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Similar to a checked exception, because &lt;code&gt;JndiLogger&lt;&#x2F;code&gt; declares that &lt;code&gt;debug&lt;&#x2F;code&gt; performs a &lt;code&gt;JndiLookup&lt;&#x2F;code&gt;, our calling code must either handle that effect or declare that it, too, &lt;code&gt;performs&lt;&#x2F;code&gt; the lookup:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java-effects&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java-effects &quot;&gt;&lt;code class=&quot;language-java-effects&quot; data-lang=&quot;java-effects&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;LogExample &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;performs &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLookup &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLogger&lt;&#x2F;span&gt;&lt;span&gt; logger &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;LogManager&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;getJndiLogger&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLogger&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;debug&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Here is a log message.&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;As with the &lt;code&gt;OpenFile&lt;&#x2F;code&gt; example, here we are just letting the runtime handle the effect, but we don&#x27;t have to. Just like with an exception, we can handle an effect. For example, we can check that the effect is safe before we let it through:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java-effects&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java-effects &quot;&gt;&lt;code class=&quot;language-java-effects&quot; data-lang=&quot;java-effects&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;LogExample &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;performs &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLookup &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLogger&lt;&#x2F;span&gt;&lt;span&gt; logger &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;LogManager&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;getJndiLogger&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLogger&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;debug&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Here is a log message.&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;handle &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLookup&lt;&#x2F;span&gt;&lt;span&gt; lookup) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;(lookup.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;getName&lt;&#x2F;span&gt;&lt;span&gt;().&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;contains&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;ldap&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)) {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; Resume to caller without a lookup
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;resume &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;[dangerous JNDI lookup]&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;            } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;else &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#898989;&quot;&gt;&#x2F;&#x2F; This is a safe request, so let it through
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;resume perform&lt;&#x2F;span&gt;&lt;span&gt; lookup;
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The &lt;code&gt;resume&lt;&#x2F;code&gt; keyword is similar to &lt;code&gt;return&lt;&#x2F;code&gt;: it returns control to the function that originally performed the effect, providing it with the specified value. In this example, we either provide a hard-coded string &lt;em&gt;or&lt;&#x2F;em&gt; we provide the result of performing the lookup, depending on whether the JNDI lookup attempts to use LDAP (in the real world we&#x27;d want a more complete check, obviously).&lt;&#x2F;p&gt;
&lt;p&gt;Alternatively, we can also handle the effect in all cases, in which case we don&#x27;t have to declare any &lt;code&gt;performs&lt;&#x2F;code&gt; on &lt;code&gt;main&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java-effects&quot; style=&quot;background-color:#ffffff;color:#010101;&quot; class=&quot;language-java-effects &quot;&gt;&lt;code class=&quot;language-java-effects&quot; data-lang=&quot;java-effects&quot;&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;LogExample &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;public static &lt;&#x2F;span&gt;&lt;span style=&quot;color:#877611;&quot;&gt;void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#a15001;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span style=&quot;color:#014a69;&quot;&gt;[] &lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span&gt;) {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLogger&lt;&#x2F;span&gt;&lt;span&gt; logger &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;LogManager&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;getJndiLogger&lt;&#x2F;span&gt;&lt;span&gt;();
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;try &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLogger&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#696989;&quot;&gt;debug&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;Here is a log message.&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;span&gt;        } &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;handle &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#646409;&quot;&gt;JndiLookup&lt;&#x2F;span&gt;&lt;span&gt; lookup) {
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#016692;&quot;&gt;resume &lt;&#x2F;span&gt;&lt;span style=&quot;color:#009f78;&quot;&gt;&amp;quot;[no JNDI lookups allowed]&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;        }
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Similar to capabilities, an effect system encodes security-sensitive side effects in the function signatures, which makes it easy to identify when code is doing something unexpected that we should take note of.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;current-implementations&quot;&gt;Current implementations&lt;&#x2F;h1&gt;
&lt;p&gt;There are already several languages that implement these concepts.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;koka-lang.github.io&#x2F;koka&#x2F;doc&#x2F;index.html&quot;&gt;Koka&lt;&#x2F;a&gt;, by Microsoft, is built around effect handlers. &lt;a href=&quot;https:&#x2F;&#x2F;discuss.ocaml.org&#x2F;t&#x2F;multicore-ocaml-september-2021-effect-handlers-will-be-in-ocaml-5-0&#x2F;8554&quot;&gt;OCaml 5.0 got support for effects&lt;&#x2F;a&gt;, with more improvements coming in future versions.&lt;&#x2F;p&gt;
&lt;p&gt;The &lt;a href=&quot;http:&#x2F;&#x2F;wiki.erights.org&#x2F;wiki&#x2F;Main_Page&quot;&gt;E language&lt;&#x2F;a&gt; is an Object Oriented language built around capabilities. Their site also has a bunch of other resources for learning more about capabilities, including this example of &lt;a href=&quot;http:&#x2F;&#x2F;www.erights.org&#x2F;elib&#x2F;capability&#x2F;ode&#x2F;ode-capabilities.html&quot;&gt;a simple digital currency&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;&#x2F;h1&gt;
&lt;p&gt;The current software supply chain situation is not sustainable: as Ken Thompson observed in the 80s, we cannot reliably expect to visually audit even a small amount of code, and the amount of open source code we use isn&#x27;t small. Going forward, programming languages will need to adopt new features that make it easy to see security flaws early in the development process.&lt;&#x2F;p&gt;
&lt;p&gt;Capabilities and effect systems are two such systems that could be used to create more security programming languages. I&#x27;ve provided some simple examples of how these might be implemented in a language like Java. There are many flaws with these solutionsI intend them primarily to illustrate that implementing these features is both possible and could be added in a way that is in line with existing idioms.&lt;&#x2F;p&gt;
&lt;p&gt;Successfully implementing either approach in an existing language would require breaking changes, but the security improvements would be well worth the migration difficulties. We can&#x27;t keep going the way we are, and both capabilities and effects offer a compelling path forward for greater security in our programming languages.&lt;&#x2F;p&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;1&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;1&lt;&#x2F;sup&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.shiftleft.io&#x2F;blog&#x2F;log4shell-jndi-injection-via-attackable-log4j&#x2F;&quot;&gt;See this article for background on Log4Shell and JNDI.&lt;&#x2F;a&gt; For this post, it&#x27;s sufficient to know that JNDI is a Java feature that allows executing remote code, and Log4J intentionally allowed using JNDI when logging, which created the vulnerability known as Log4Shell.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;2&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;2&lt;&#x2F;sup&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;dl.acm.org&#x2F;doi&#x2F;pdf&#x2F;10.1145&#x2F;358198.358210&quot;&gt;https:&#x2F;&#x2F;dl.acm.org&#x2F;doi&#x2F;pdf&#x2F;10.1145&#x2F;358198.358210&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;3&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;3&lt;&#x2F;sup&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Object-capability_model&quot;&gt;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Object-capability_model&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;4&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;4&lt;&#x2F;sup&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.scala-lang.org&#x2F;scala3&#x2F;reference&#x2F;contextual&#x2F;using-clauses.html&quot;&gt;https:&#x2F;&#x2F;docs.scala-lang.org&#x2F;scala3&#x2F;reference&#x2F;contextual&#x2F;using-clauses.html&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>The Tooling</title>
        <published>2022-09-01T20:46:25-06:00</published>
        <updated>2022-09-01T20:46:25-06:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://nschulzke.com/22-09-01-the-tooling/" type="text/html"/>
        <id>https://nschulzke.com/22-09-01-the-tooling/</id>
        
        <summary type="html">&lt;p&gt;In this post I&#x27;m going to get set up with the playground tooling I&#x27;ll use to showcase the languages I discuss here. The goal is to have something similar to a Jupyter notebook: a series of executable text-editor fields that share an environment.&lt;&#x2F;p&gt;
</summary>
        
    </entry>
    <entry xml:lang="en">
        <title>The Beginning</title>
        <published>2022-08-26T20:22:09-06:00</published>
        <updated>2022-08-26T20:22:09-06:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://nschulzke.com/22-08-26-the-beginning/" type="text/html"/>
        <id>https://nschulzke.com/22-08-26-the-beginning/</id>
        
        <summary type="html">&lt;p&gt;I&#x27;m a language enthusiast. Natural and constructed, computer and human, I love language in all its forms. I particularly love inventing languages. My childhood obsession with &lt;a href=&quot;https:&#x2F;&#x2F;conlang.org&#x2F;&quot;&gt;conlangs&lt;&#x2F;a&gt; turned into an adult obsession with designing programming languges, and between the two I&#x27;ve spent more hours than I can possibly count tinkering with grammar, syntax, and semantics.&lt;&#x2F;p&gt;
</summary>
        
    </entry>
</feed>
